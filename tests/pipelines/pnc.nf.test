nextflow_pipeline {
    name "PNC Tests for Arborator Pipeline"
    script "main.nf"

    test("Outbreak Confirmation"){
        tag "pnc"
        tag "pnc_outbreak_confirmation"

        config "$baseDir/tests/data/pnc/outbreak-confirmation/nextflow.config"

        when {
            params {
                input = "$baseDir/tests/data/pnc/outbreak-confirmation/samplesheet.csv"
                outdir = "results"

                ar_config = "https://raw.githubusercontent.com/phac-nml/arboratornf/refs/heads/test_pnc/tests/data/pnc/outbreak-confirmation/arborator.config.json"
                ar_thresholds = "30,25,20,15,10,5"

                tree_distances = "cophenetic"
            }
        }

        then {
            assert workflow.success
            assert path("$launchDir/results").exists()

            // Check that files exist:
            def arborator_1_clusters = path("$launchDir/results/arborator/1_clusters.tsv")
            def arborator_1_loci = path("$launchDir/results/arborator/1_loci.summary.tsv")
            def arborator_1_matrix = path("$launchDir/results/arborator/1_matrix.tsv")
            def arborator_1_metadata = path("$launchDir/results/arborator/1_metadata.tsv")
            def arborator_1_outliers = path("$launchDir/results/arborator/1_outliers.tsv")
            def arborator_1_profile = path("$launchDir/results/arborator/1_profile.tsv")
            def arborator_1_tree = path("$launchDir/results/arborator/1_tree.nwk")

            assert arborator_1_clusters.exists()
            assert arborator_1_loci.exists()
            assert arborator_1_matrix.exists()
            assert arborator_1_metadata.exists()
            assert arborator_1_outliers.exists()
            assert arborator_1_profile.exists()
            assert arborator_1_tree.exists()

            def arborator_2_clusters = path("$launchDir/results/arborator/2_clusters.tsv")
            def arborator_2_loci = path("$launchDir/results/arborator/2_loci.summary.tsv")
            def arborator_2_matrix = path("$launchDir/results/arborator/2_matrix.tsv")
            def arborator_2_metadata = path("$launchDir/results/arborator/2_metadata.tsv")
            def arborator_2_outliers = path("$launchDir/results/arborator/2_outliers.tsv")
            def arborator_2_profile = path("$launchDir/results/arborator/2_profile.tsv")
            def arborator_2_tree = path("$launchDir/results/arborator/2_tree.nwk")

            assert arborator_2_clusters.exists()
            assert arborator_2_loci.exists()
            assert arborator_2_matrix.exists()
            assert arborator_2_metadata.exists()
            assert arborator_2_outliers.exists()
            assert arborator_2_profile.exists()
            assert arborator_2_tree.exists()

            def arborator_3_clusters = path("$launchDir/results/arborator/3_clusters.tsv")
            def arborator_3_loci = path("$launchDir/results/arborator/3_loci.summary.tsv")
            def arborator_3_matrix = path("$launchDir/results/arborator/3_matrix.tsv")
            def arborator_3_metadata = path("$launchDir/results/arborator/3_metadata.tsv")
            def arborator_3_outliers = path("$launchDir/results/arborator/3_outliers.tsv")
            def arborator_3_profile = path("$launchDir/results/arborator/3_profile.tsv")
            def arborator_3_tree = path("$launchDir/results/arborator/3_tree.nwk")

            assert arborator_3_clusters.exists()
            assert arborator_3_loci.exists()
            assert arborator_3_matrix.exists()
            assert arborator_3_metadata.exists()
            assert arborator_3_outliers.exists()
            assert arborator_3_profile.exists()
            assert arborator_3_tree.exists()

            def arborator_4_clusters = path("$launchDir/results/arborator/4_clusters.tsv")
            def arborator_4_loci = path("$launchDir/results/arborator/4_loci.summary.tsv")
            def arborator_4_matrix = path("$launchDir/results/arborator/4_matrix.tsv")
            def arborator_4_metadata = path("$launchDir/results/arborator/4_metadata.tsv")
            def arborator_4_outliers = path("$launchDir/results/arborator/4_outliers.tsv")
            def arborator_4_profile = path("$launchDir/results/arborator/4_profile.tsv")
            def arborator_4_tree = path("$launchDir/results/arborator/4_tree.nwk")

            assert arborator_4_clusters.exists()
            assert arborator_4_loci.exists()
            assert arborator_4_matrix.exists()
            assert arborator_4_metadata.exists()
            assert arborator_4_outliers.exists()
            assert arborator_4_profile.exists()
            assert arborator_4_tree.exists()

            def arborator_5_clusters = path("$launchDir/results/arborator/5_clusters.tsv")
            def arborator_5_loci = path("$launchDir/results/arborator/5_loci.summary.tsv")
            def arborator_5_matrix = path("$launchDir/results/arborator/5_matrix.tsv")
            def arborator_5_metadata = path("$launchDir/results/arborator/5_metadata.tsv")
            def arborator_5_outliers = path("$launchDir/results/arborator/5_outliers.tsv")
            def arborator_5_profile = path("$launchDir/results/arborator/5_profile.tsv")
            def arborator_5_tree = path("$launchDir/results/arborator/5_tree.nwk")

            assert arborator_5_clusters.exists()
            assert arborator_5_loci.exists()
            assert arborator_5_matrix.exists()
            assert arborator_5_metadata.exists()
            assert arborator_5_outliers.exists()
            assert arborator_5_profile.exists()
            assert arborator_5_tree.exists()

            def arborator_6_clusters = path("$launchDir/results/arborator/6_clusters.tsv")
            def arborator_6_loci = path("$launchDir/results/arborator/6_loci.summary.tsv")
            def arborator_6_matrix = path("$launchDir/results/arborator/6_matrix.tsv")
            def arborator_6_metadata = path("$launchDir/results/arborator/6_metadata.tsv")
            def arborator_6_outliers = path("$launchDir/results/arborator/6_outliers.tsv")
            def arborator_6_profile = path("$launchDir/results/arborator/6_profile.tsv")
            def arborator_6_tree = path("$launchDir/results/arborator/6_tree.nwk")

            assert arborator_6_clusters.exists()
            assert arborator_6_loci.exists()
            assert arborator_6_matrix.exists()
            assert arborator_6_metadata.exists()
            assert arborator_6_outliers.exists()
            assert arborator_6_profile.exists()
            assert arborator_6_tree.exists()

            def arborator_7_clusters = path("$launchDir/results/arborator/7_clusters.tsv")
            def arborator_7_loci = path("$launchDir/results/arborator/7_loci.summary.tsv")
            def arborator_7_matrix = path("$launchDir/results/arborator/7_matrix.tsv")
            def arborator_7_metadata = path("$launchDir/results/arborator/7_metadata.tsv")
            def arborator_7_outliers = path("$launchDir/results/arborator/7_outliers.tsv")
            def arborator_7_profile = path("$launchDir/results/arborator/7_profile.tsv")
            def arborator_7_tree = path("$launchDir/results/arborator/7_tree.nwk")

            assert arborator_7_clusters.exists()
            assert arborator_7_loci.exists()
            assert arborator_7_matrix.exists()
            assert arborator_7_metadata.exists()
            assert arborator_7_outliers.exists()
            assert arborator_7_profile.exists()
            assert arborator_7_tree.exists()

            def arborator_8_clusters = path("$launchDir/results/arborator/8_clusters.tsv")
            def arborator_8_loci = path("$launchDir/results/arborator/8_loci.summary.tsv")
            def arborator_8_matrix = path("$launchDir/results/arborator/8_matrix.tsv")
            def arborator_8_metadata = path("$launchDir/results/arborator/8_metadata.tsv")
            def arborator_8_outliers = path("$launchDir/results/arborator/8_outliers.tsv")
            def arborator_8_profile = path("$launchDir/results/arborator/8_profile.tsv")
            def arborator_8_tree = path("$launchDir/results/arborator/8_tree.nwk")

            assert arborator_8_clusters.exists()
            assert arborator_8_loci.exists()
            assert arborator_8_matrix.exists()
            assert arborator_8_metadata.exists()
            assert arborator_8_outliers.exists()
            assert arborator_8_profile.exists()
            assert arborator_8_tree.exists()

            def arborator_9_clusters = path("$launchDir/results/arborator/9_clusters.tsv")
            def arborator_9_loci = path("$launchDir/results/arborator/9_loci.summary.tsv")
            def arborator_9_matrix = path("$launchDir/results/arborator/9_matrix.tsv")
            def arborator_9_metadata = path("$launchDir/results/arborator/9_metadata.tsv")
            def arborator_9_outliers = path("$launchDir/results/arborator/9_outliers.tsv")
            def arborator_9_profile = path("$launchDir/results/arborator/9_profile.tsv")
            def arborator_9_tree = path("$launchDir/results/arborator/9_tree.nwk")

            assert arborator_9_clusters.exists()
            assert arborator_9_loci.exists()
            assert arborator_9_matrix.exists()
            assert arborator_9_metadata.exists()
            assert arborator_9_outliers.exists()
            assert arborator_9_profile.exists()
            assert arborator_9_tree.exists()

            def arborator_10_clusters = path("$launchDir/results/arborator/10_clusters.tsv")
            def arborator_10_loci = path("$launchDir/results/arborator/10_loci.summary.tsv")
            def arborator_10_matrix = path("$launchDir/results/arborator/10_matrix.tsv")
            def arborator_10_metadata = path("$launchDir/results/arborator/10_metadata.tsv")
            def arborator_10_outliers = path("$launchDir/results/arborator/10_outliers.tsv")
            def arborator_10_profile = path("$launchDir/results/arborator/10_profile.tsv")
            def arborator_10_tree = path("$launchDir/results/arborator/10_tree.nwk")

            assert arborator_10_clusters.exists()
            assert arborator_10_loci.exists()
            assert arborator_10_matrix.exists()
            assert arborator_10_metadata.exists()
            assert arborator_10_outliers.exists()
            assert arborator_10_profile.exists()
            assert arborator_10_tree.exists()

            def cluster_summary = path("$launchDir/results/arborator/cluster_summary.tsv")
            def cluster_summary_xlsx = path("$launchDir/results/arborator/cluster_summary.xlsx")
            def metadata_excluded = path("$launchDir/results/arborator/metadata.excluded.tsv")
            def metadata_included = path("$launchDir/results/arborator/metadata.included.tsv")
            def metadata_linelist = path("$launchDir/results/arborator/metadata.linelist.xlsx")
            def run_json = path("$launchDir/results/arborator/run.json")
            def threshold_map = path("$launchDir/results/arborator/threshold_map.json")

            assert cluster_summary.exists()
            assert cluster_summary_xlsx.exists()
            assert metadata_excluded.exists()
            assert metadata_included.exists()
            assert metadata_linelist.exists()
            assert run_json.exists()
            assert threshold_map.exists()

            def arborview_1 = path("$launchDir/results/arborview/1_arborview.html")
            def arborview_2 = path("$launchDir/results/arborview/2_arborview.html")
            def arborview_3 = path("$launchDir/results/arborview/3_arborview.html")
            def arborview_4 = path("$launchDir/results/arborview/4_arborview.html")
            def arborview_5 = path("$launchDir/results/arborview/5_arborview.html")
            def arborview_6 = path("$launchDir/results/arborview/6_arborview.html")
            def arborview_7 = path("$launchDir/results/arborview/7_arborview.html")
            def arborview_8 = path("$launchDir/results/arborview/8_arborview.html")
            def arborview_9 = path("$launchDir/results/arborview/9_arborview.html")
            def arborview_10 = path("$launchDir/results/arborview/10_arborview.html")

            assert arborview_1.exists()
            assert arborview_2.exists()
            assert arborview_3.exists()
            assert arborview_4.exists()
            assert arborview_5.exists()
            assert arborview_6.exists()
            assert arborview_7.exists()
            assert arborview_8.exists()
            assert arborview_9.exists()
            assert arborview_10.exists()

            def iridanext_output = path("$launchDir/results/iridanext.output.json")

            assert iridanext_output.exists()

            // Irida Next Output:
            def iridanext_json = iridanext_output.json
            def iridanext_global = iridanext_json.files.global
            def iridanext_samples = iridanext_json.files.samples
            def iridanext_metadata = iridanext_json.metadata.samples

            assert iridanext_global.findAll { it.path == "arborator/1_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/3_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/3_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/3_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/3_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/3_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/3_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/3_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/4_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/4_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/4_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/4_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/4_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/4_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/4_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/5_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/6_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/6_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/6_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/6_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/6_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/6_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/6_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/7_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/7_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/7_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/7_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/7_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/7_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/7_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/8_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/8_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/8_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/8_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/8_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/8_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/8_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/9_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/9_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/9_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/9_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/9_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/9_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/9_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/10_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/cluster_summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/metadata.excluded.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/metadata.included.tsv" }.size() == 1
        }
    }

    test("Outbreak Detection"){
        tag "pnc"
        tag "pnc_outbreak_detection"

        config "$baseDir/tests/data/pnc/outbreak-detection/nextflow.config"

        when {
            params {
                input = "$baseDir/tests/data/pnc/outbreak-detection/samplesheet.csv"
                outdir = "results"

                ar_config = "https://raw.githubusercontent.com/phac-nml/arboratornf/refs/heads/test_pnc/tests/data/pnc/outbreak-detection/arborator.config.json"
                ar_thresholds = "30,25,20,15,10,5"

                tree_distances = "cophenetic"
            }
        }

        then {
            assert workflow.success
            assert path("$launchDir/results").exists()

            // Check that files exist:
            def arborator_1_1_1_1_clusters = path("$launchDir/results/arborator/1.1.1.1_clusters.tsv")
            def arborator_1_1_1_1_loci = path("$launchDir/results/arborator/1.1.1.1_loci.summary.tsv")
            def arborator_1_1_1_1_matrix = path("$launchDir/results/arborator/1.1.1.1_matrix.tsv")
            def arborator_1_1_1_1_metadata = path("$launchDir/results/arborator/1.1.1.1_metadata.tsv")
            def arborator_1_1_1_1_outliers = path("$launchDir/results/arborator/1.1.1.1_outliers.tsv")
            def arborator_1_1_1_1_profile = path("$launchDir/results/arborator/1.1.1.1_profile.tsv")
            def arborator_1_1_1_1_tree = path("$launchDir/results/arborator/1.1.1.1_tree.nwk")

            assert arborator_1_1_1_1_clusters.exists()
            assert arborator_1_1_1_1_loci.exists()
            assert arborator_1_1_1_1_matrix.exists()
            assert arborator_1_1_1_1_metadata.exists()
            assert arborator_1_1_1_1_outliers.exists()
            assert arborator_1_1_1_1_profile.exists()
            assert arborator_1_1_1_1_tree.exists()

            def arborator_1_1_2_2_clusters = path("$launchDir/results/arborator/1.1.2.2_clusters.tsv")
            def arborator_1_1_2_2_loci = path("$launchDir/results/arborator/1.1.2.2_loci.summary.tsv")
            def arborator_1_1_2_2_matrix = path("$launchDir/results/arborator/1.1.2.2_matrix.tsv")
            def arborator_1_1_2_2_metadata = path("$launchDir/results/arborator/1.1.2.2_metadata.tsv")
            def arborator_1_1_2_2_outliers = path("$launchDir/results/arborator/1.1.2.2_outliers.tsv")
            def arborator_1_1_2_2_profile = path("$launchDir/results/arborator/1.1.2.2_profile.tsv")
            def arborator_1_1_2_2_tree = path("$launchDir/results/arborator/1.1.2.2_tree.nwk")

            assert arborator_1_1_2_2_clusters.exists()
            assert arborator_1_1_2_2_loci.exists()
            assert arborator_1_1_2_2_matrix.exists()
            assert arborator_1_1_2_2_metadata.exists()
            assert arborator_1_1_2_2_outliers.exists()
            assert arborator_1_1_2_2_profile.exists()
            assert arborator_1_1_2_2_tree.exists()

            def arborator_1_3_3_3_clusters = path("$launchDir/results/arborator/1.3.3.3_clusters.tsv")
            def arborator_1_3_3_3_loci = path("$launchDir/results/arborator/1.3.3.3_loci.summary.tsv")
            def arborator_1_3_3_3_matrix = path("$launchDir/results/arborator/1.3.3.3_matrix.tsv")
            def arborator_1_3_3_3_metadata = path("$launchDir/results/arborator/1.3.3.3_metadata.tsv")
            def arborator_1_3_3_3_outliers = path("$launchDir/results/arborator/1.3.3.3_outliers.tsv")
            def arborator_1_3_3_3_profile = path("$launchDir/results/arborator/1.3.3.3_profile.tsv")
            def arborator_1_3_3_3_tree = path("$launchDir/results/arborator/1.3.3.3_tree.nwk")

            assert arborator_1_3_3_3_clusters.exists()
            assert arborator_1_3_3_3_loci.exists()
            assert arborator_1_3_3_3_matrix.exists()
            assert arborator_1_3_3_3_metadata.exists()
            assert arborator_1_3_3_3_outliers.exists()
            assert arborator_1_3_3_3_profile.exists()
            assert arborator_1_3_3_3_tree.exists()

            def arborator_2_4_4_4_clusters = path("$launchDir/results/arborator/2.4.4.4_clusters.tsv")
            def arborator_2_4_4_4_loci = path("$launchDir/results/arborator/2.4.4.4_loci.summary.tsv")
            def arborator_2_4_4_4_matrix = path("$launchDir/results/arborator/2.4.4.4_matrix.tsv")
            def arborator_2_4_4_4_metadata = path("$launchDir/results/arborator/2.4.4.4_metadata.tsv")
            def arborator_2_4_4_4_outliers = path("$launchDir/results/arborator/2.4.4.4_outliers.tsv")
            def arborator_2_4_4_4_profile = path("$launchDir/results/arborator/2.4.4.4_profile.tsv")
            def arborator_2_4_4_4_tree = path("$launchDir/results/arborator/2.4.4.4_tree.nwk")

            assert arborator_2_4_4_4_clusters.exists()
            assert arborator_2_4_4_4_loci.exists()
            assert arborator_2_4_4_4_matrix.exists()
            assert arborator_2_4_4_4_metadata.exists()
            assert arborator_2_4_4_4_outliers.exists()
            assert arborator_2_4_4_4_profile.exists()
            assert arborator_2_4_4_4_tree.exists()

            def arborator_5_5_5_21000_clusters = path("$launchDir/results/arborator/5.5.5.21000_clusters.tsv")
            def arborator_5_5_5_21000_loci = path("$launchDir/results/arborator/5.5.5.21000_loci.summary.tsv")
            def arborator_5_5_5_21000_matrix = path("$launchDir/results/arborator/5.5.5.21000_matrix.tsv")
            def arborator_5_5_5_21000_metadata = path("$launchDir/results/arborator/5.5.5.21000_metadata.tsv")
            def arborator_5_5_5_21000_outliers = path("$launchDir/results/arborator/5.5.5.21000_outliers.tsv")
            def arborator_5_5_5_21000_profile = path("$launchDir/results/arborator/5.5.5.21000_profile.tsv")
            def arborator_5_5_5_21000_tree = path("$launchDir/results/arborator/5.5.5.21000_tree.nwk")

            assert arborator_5_5_5_21000_clusters.exists()
            assert arborator_5_5_5_21000_loci.exists()
            assert arborator_5_5_5_21000_matrix.exists()
            assert arborator_5_5_5_21000_metadata.exists()
            assert arborator_5_5_5_21000_outliers.exists()
            assert arborator_5_5_5_21000_profile.exists()
            assert arborator_5_5_5_21000_tree.exists()

            def arborator_10_10_10_10_clusters = path("$launchDir/results/arborator/10.10.10.10_clusters.tsv")
            def arborator_10_10_10_10_loci = path("$launchDir/results/arborator/10.10.10.10_loci.summary.tsv")
            def arborator_10_10_10_10_matrix = path("$launchDir/results/arborator/10.10.10.10_matrix.tsv")
            def arborator_10_10_10_10_metadata = path("$launchDir/results/arborator/10.10.10.10_metadata.tsv")
            def arborator_10_10_10_10_outliers = path("$launchDir/results/arborator/10.10.10.10_outliers.tsv")
            def arborator_10_10_10_10_profile = path("$launchDir/results/arborator/10.10.10.10_profile.tsv")
            def arborator_10_10_10_10_tree = path("$launchDir/results/arborator/10.10.10.10_tree.nwk")

            assert arborator_10_10_10_10_clusters.exists()
            assert arborator_10_10_10_10_loci.exists()
            assert arborator_10_10_10_10_matrix.exists()
            assert arborator_10_10_10_10_metadata.exists()
            assert arborator_10_10_10_10_outliers.exists()
            assert arborator_10_10_10_10_profile.exists()
            assert arborator_10_10_10_10_tree.exists()

            def arborator_70_70_90_110_clusters = path("$launchDir/results/arborator/70.70.90.110_clusters.tsv")
            def arborator_70_70_90_110_loci = path("$launchDir/results/arborator/70.70.90.110_loci.summary.tsv")
            def arborator_70_70_90_110_matrix = path("$launchDir/results/arborator/70.70.90.110_matrix.tsv")
            def arborator_70_70_90_110_metadata = path("$launchDir/results/arborator/70.70.90.110_metadata.tsv")
            def arborator_70_70_90_110_outliers = path("$launchDir/results/arborator/70.70.90.110_outliers.tsv")
            def arborator_70_70_90_110_profile = path("$launchDir/results/arborator/70.70.90.110_profile.tsv")
            def arborator_70_70_90_110_tree = path("$launchDir/results/arborator/70.70.90.110_tree.nwk")

            assert arborator_70_70_90_110_clusters.exists()
            assert arborator_70_70_90_110_loci.exists()
            assert arborator_70_70_90_110_matrix.exists()
            assert arborator_70_70_90_110_metadata.exists()
            assert arborator_70_70_90_110_outliers.exists()
            assert arborator_70_70_90_110_profile.exists()
            assert arborator_70_70_90_110_tree.exists()

            def arborator_100_200_300_400_clusters = path("$launchDir/results/arborator/100.200.300.400_clusters.tsv")
            def arborator_100_200_300_400_loci = path("$launchDir/results/arborator/100.200.300.400_loci.summary.tsv")
            def arborator_100_200_300_400_matrix = path("$launchDir/results/arborator/100.200.300.400_matrix.tsv")
            def arborator_100_200_300_400_metadata = path("$launchDir/results/arborator/100.200.300.400_metadata.tsv")
            def arborator_100_200_300_400_outliers = path("$launchDir/results/arborator/100.200.300.400_outliers.tsv")
            def arborator_100_200_300_400_profile = path("$launchDir/results/arborator/100.200.300.400_profile.tsv")
            def arborator_100_200_300_400_tree = path("$launchDir/results/arborator/100.200.300.400_tree.nwk")

            assert arborator_100_200_300_400_clusters.exists()
            assert arborator_100_200_300_400_loci.exists()
            assert arborator_100_200_300_400_matrix.exists()
            assert arborator_100_200_300_400_metadata.exists()
            assert arborator_100_200_300_400_outliers.exists()
            assert arborator_100_200_300_400_profile.exists()
            assert arborator_100_200_300_400_tree.exists()

            def arborator_999_1000_1000_5000_clusters = path("$launchDir/results/arborator/999.1000.1000.5000_clusters.tsv")
            def arborator_999_1000_1000_5000_loci = path("$launchDir/results/arborator/999.1000.1000.5000_loci.summary.tsv")
            def arborator_999_1000_1000_5000_matrix = path("$launchDir/results/arborator/999.1000.1000.5000_matrix.tsv")
            def arborator_999_1000_1000_5000_metadata = path("$launchDir/results/arborator/999.1000.1000.5000_metadata.tsv")
            def arborator_999_1000_1000_5000_outliers = path("$launchDir/results/arborator/999.1000.1000.5000_outliers.tsv")
            def arborator_999_1000_1000_5000_profile = path("$launchDir/results/arborator/999.1000.1000.5000_profile.tsv")
            def arborator_999_1000_1000_5000_tree = path("$launchDir/results/arborator/999.1000.1000.5000_tree.nwk")

            assert arborator_999_1000_1000_5000_clusters.exists()
            assert arborator_999_1000_1000_5000_loci.exists()
            assert arborator_999_1000_1000_5000_matrix.exists()
            assert arborator_999_1000_1000_5000_metadata.exists()
            assert arborator_999_1000_1000_5000_outliers.exists()
            assert arborator_999_1000_1000_5000_profile.exists()
            assert arborator_999_1000_1000_5000_tree.exists()

            def arborator_5000_5000_5000_10000_clusters = path("$launchDir/results/arborator/5000.5000.5000.10000_clusters.tsv")
            def arborator_5000_5000_5000_10000_loci = path("$launchDir/results/arborator/5000.5000.5000.10000_loci.summary.tsv")
            def arborator_5000_5000_5000_10000_matrix = path("$launchDir/results/arborator/5000.5000.5000.10000_matrix.tsv")
            def arborator_5000_5000_5000_10000_metadata = path("$launchDir/results/arborator/5000.5000.5000.10000_metadata.tsv")
            def arborator_5000_5000_5000_10000_outliers = path("$launchDir/results/arborator/5000.5000.5000.10000_outliers.tsv")
            def arborator_5000_5000_5000_10000_profile = path("$launchDir/results/arborator/5000.5000.5000.10000_profile.tsv")
            def arborator_5000_5000_5000_10000_tree = path("$launchDir/results/arborator/5000.5000.5000.10000_tree.nwk")

            assert arborator_5000_5000_5000_10000_clusters.exists()
            assert arborator_5000_5000_5000_10000_loci.exists()
            assert arborator_5000_5000_5000_10000_matrix.exists()
            assert arborator_5000_5000_5000_10000_metadata.exists()
            assert arborator_5000_5000_5000_10000_outliers.exists()
            assert arborator_5000_5000_5000_10000_profile.exists()
            assert arborator_5000_5000_5000_10000_tree.exists()

            def cluster_summary = path("$launchDir/results/arborator/cluster_summary.tsv")
            def cluster_summary_xlsx = path("$launchDir/results/arborator/cluster_summary.xlsx")
            def metadata_excluded = path("$launchDir/results/arborator/metadata.excluded.tsv")
            def metadata_included = path("$launchDir/results/arborator/metadata.included.tsv")
            def metadata_linelist = path("$launchDir/results/arborator/metadata.linelist.xlsx")
            def run_json = path("$launchDir/results/arborator/run.json")
            def threshold_map = path("$launchDir/results/arborator/threshold_map.json")

            assert cluster_summary.exists()
            assert cluster_summary_xlsx.exists()
            assert metadata_excluded.exists()
            assert metadata_included.exists()
            assert metadata_linelist.exists()
            assert run_json.exists()
            assert threshold_map.exists()

            def arborview_1_1_1_1 = path("$launchDir/results/arborview/1.1.1.1_arborview.html")
            def arborview_1_1_2_2 = path("$launchDir/results/arborview/1.1.2.2_arborview.html")
            def arborview_1_3_3_3 = path("$launchDir/results/arborview/1.3.3.3_arborview.html")
            def arborview_2_4_4_4 = path("$launchDir/results/arborview/2.4.4.4_arborview.html")
            def arborview_5_5_5_21000 = path("$launchDir/results/arborview/5.5.5.21000_arborview.html")
            def arborview_10_10_10_10 = path("$launchDir/results/arborview/10.10.10.10_arborview.html")
            def arborview_70_70_90_110 = path("$launchDir/results/arborview/70.70.90.110_arborview.html")
            def arborview_100_200_300_400 = path("$launchDir/results/arborview/100.200.300.400_arborview.html")
            def arborview_999_1000_1000_5000 = path("$launchDir/results/arborview/999.1000.1000.5000_arborview.html")
            def arborview_5000_5000_5000_10000 = path("$launchDir/results/arborview/5000.5000.5000.10000_arborview.html")

            assert arborview_1_1_1_1.exists()
            assert arborview_1_1_2_2.exists()
            assert arborview_1_3_3_3.exists()
            assert arborview_2_4_4_4.exists()
            assert arborview_5_5_5_21000.exists()
            assert arborview_10_10_10_10.exists()
            assert arborview_70_70_90_110.exists()
            assert arborview_100_200_300_400.exists()
            assert arborview_999_1000_1000_5000.exists()
            assert arborview_5000_5000_5000_10000.exists()

            def iridanext_output = path("$launchDir/results/iridanext.output.json")

            assert iridanext_output.exists()

            // Irida Next Output:
            def iridanext_json = iridanext_output.json
            def iridanext_global = iridanext_json.files.global
            def iridanext_samples = iridanext_json.files.samples
            def iridanext_metadata = iridanext_json.metadata.samples

            assert iridanext_global.findAll { it.path == "arborator/1.1.1.1_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.1.1_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.1.1_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.1.1_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.1.1_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.1.1_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.1.1_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/1.1.2.2_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.2.2_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.2.2_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.2.2_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.2.2_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.2.2_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.1.2.2_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/1.3.3.3_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.3.3.3_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.3.3.3_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.3.3.3_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.3.3.3_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.3.3.3_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/1.3.3.3_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2.4.4.4_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2.4.4.4_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2.4.4.4_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2.4.4.4_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2.4.4.4_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2.4.4.4_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2.4.4.4_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/5.5.5.21000_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5.5.5.21000_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5.5.5.21000_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5.5.5.21000_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5.5.5.21000_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5.5.5.21000_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5.5.5.21000_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/10.10.10.10_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10.10.10.10_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10.10.10.10_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10.10.10.10_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10.10.10.10_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10.10.10.10_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/10.10.10.10_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/70.70.90.110_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/70.70.90.110_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/70.70.90.110_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/70.70.90.110_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/70.70.90.110_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/70.70.90.110_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/70.70.90.110_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/100.200.300.400_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/100.200.300.400_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/100.200.300.400_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/100.200.300.400_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/100.200.300.400_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/100.200.300.400_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/100.200.300.400_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/999.1000.1000.5000_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/999.1000.1000.5000_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/999.1000.1000.5000_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/999.1000.1000.5000_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/999.1000.1000.5000_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/999.1000.1000.5000_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/999.1000.1000.5000_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/5000.5000.5000.10000_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5000.5000.5000.10000_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5000.5000.5000.10000_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5000.5000.5000.10000_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5000.5000.5000.10000_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5000.5000.5000.10000_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/5000.5000.5000.10000_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/cluster_summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/metadata.excluded.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/metadata.included.tsv" }.size() == 1
        }
    }

    test("Outbreak Reporting"){
        tag "pnc"
        tag "pnc_outbreak_reporting"

        config "$baseDir/tests/data/pnc/outbreak-reporting/nextflow.config"

        when {
            params {
                input = "$baseDir/tests/data/pnc/outbreak-reporting/samplesheet.csv"
                outdir = "results"

                ar_config = "https://raw.githubusercontent.com/phac-nml/arboratornf/refs/heads/test_pnc/tests/data/pnc/outbreak-reporting/arborator.config.json"
                ar_thresholds = "30,25,20,15,10,5"

                tree_distances = "cophenetic"
            }
        }

        then {
            assert workflow.success
            assert path("$launchDir/results").exists()

            // Check that files exist:
            def arborator_2501STWGS_01_clusters = path("$launchDir/results/arborator/2501STWGS-01_clusters.tsv")
            def arborator_2501STWGS_01_loci = path("$launchDir/results/arborator/2501STWGS-01_loci.summary.tsv")
            def arborator_2501STWGS_01_matrix = path("$launchDir/results/arborator/2501STWGS-01_matrix.tsv")
            def arborator_2501STWGS_01_metadata = path("$launchDir/results/arborator/2501STWGS-01_metadata.tsv")
            def arborator_2501STWGS_01_outliers = path("$launchDir/results/arborator/2501STWGS-01_outliers.tsv")
            def arborator_2501STWGS_01_profile = path("$launchDir/results/arborator/2501STWGS-01_profile.tsv")
            def arborator_2501STWGS_01_tree = path("$launchDir/results/arborator/2501STWGS-01_tree.nwk")

            assert arborator_2501STWGS_01_clusters.exists()
            assert arborator_2501STWGS_01_loci.exists()
            assert arborator_2501STWGS_01_matrix.exists()
            assert arborator_2501STWGS_01_metadata.exists()
            assert arborator_2501STWGS_01_outliers.exists()
            assert arborator_2501STWGS_01_profile.exists()
            assert arborator_2501STWGS_01_tree.exists()

            def arborator_2502SEWGS_01_clusters = path("$launchDir/results/arborator/2502SEWGS-01_clusters.tsv")
            def arborator_2502SEWGS_01_loci = path("$launchDir/results/arborator/2502SEWGS-01_loci.summary.tsv")
            def arborator_2502SEWGS_01_matrix = path("$launchDir/results/arborator/2502SEWGS-01_matrix.tsv")
            def arborator_2502SEWGS_01_metadata = path("$launchDir/results/arborator/2502SEWGS-01_metadata.tsv")
            def arborator_2502SEWGS_01_outliers = path("$launchDir/results/arborator/2502SEWGS-01_outliers.tsv")
            def arborator_2502SEWGS_01_profile = path("$launchDir/results/arborator/2502SEWGS-01_profile.tsv")
            def arborator_2502SEWGS_01_tree = path("$launchDir/results/arborator/2502SEWGS-01_tree.nwk")

            assert arborator_2502SEWGS_01_clusters.exists()
            assert arborator_2502SEWGS_01_loci.exists()
            assert arborator_2502SEWGS_01_matrix.exists()
            assert arborator_2502SEWGS_01_metadata.exists()
            assert arborator_2502SEWGS_01_outliers.exists()
            assert arborator_2502SEWGS_01_profile.exists()
            assert arborator_2502SEWGS_01_tree.exists()

            def arborator_2503SHWGS_01_clusters = path("$launchDir/results/arborator/2503SHWGS-01_clusters.tsv")
            def arborator_2503SHWGS_01_loci = path("$launchDir/results/arborator/2503SHWGS-01_loci.summary.tsv")
            def arborator_2503SHWGS_01_matrix = path("$launchDir/results/arborator/2503SHWGS-01_matrix.tsv")
            def arborator_2503SHWGS_01_metadata = path("$launchDir/results/arborator/2503SHWGS-01_metadata.tsv")
            def arborator_2503SHWGS_01_outliers = path("$launchDir/results/arborator/2503SHWGS-01_outliers.tsv")
            def arborator_2503SHWGS_01_profile = path("$launchDir/results/arborator/2503SHWGS-01_profile.tsv")
            def arborator_2503SHWGS_01_tree = path("$launchDir/results/arborator/2503SHWGS-01_tree.nwk")

            assert arborator_2503SHWGS_01_clusters.exists()
            assert arborator_2503SHWGS_01_loci.exists()
            assert arborator_2503SHWGS_01_matrix.exists()
            assert arborator_2503SHWGS_01_metadata.exists()
            assert arborator_2503SHWGS_01_outliers.exists()
            assert arborator_2503SHWGS_01_profile.exists()
            assert arborator_2503SHWGS_01_tree.exists()

            def arborator_2504SAL_01_clusters = path("$launchDir/results/arborator/2504SAL-01_clusters.tsv")
            def arborator_2504SAL_01_loci = path("$launchDir/results/arborator/2504SAL-01_loci.summary.tsv")
            def arborator_2504SAL_01_matrix = path("$launchDir/results/arborator/2504SAL-01_matrix.tsv")
            def arborator_2504SAL_01_metadata = path("$launchDir/results/arborator/2504SAL-01_metadata.tsv")
            def arborator_2504SAL_01_outliers = path("$launchDir/results/arborator/2504SAL-01_outliers.tsv")
            def arborator_2504SAL_01_profile = path("$launchDir/results/arborator/2504SAL-01_profile.tsv")
            def arborator_2504SAL_01_tree = path("$launchDir/results/arborator/2504SAL-01_tree.nwk")

            assert arborator_2504SAL_01_clusters.exists()
            assert arborator_2504SAL_01_loci.exists()
            assert arborator_2504SAL_01_matrix.exists()
            assert arborator_2504SAL_01_metadata.exists()
            assert arborator_2504SAL_01_outliers.exists()
            assert arborator_2504SAL_01_profile.exists()
            assert arborator_2504SAL_01_tree.exists()

            def arborator_2505SAL_01_clusters = path("$launchDir/results/arborator/2505SAL-01_clusters.tsv")
            def arborator_2505SAL_01_loci = path("$launchDir/results/arborator/2505SAL-01_loci.summary.tsv")
            def arborator_2505SAL_01_matrix = path("$launchDir/results/arborator/2505SAL-01_matrix.tsv")
            def arborator_2505SAL_01_metadata = path("$launchDir/results/arborator/2505SAL-01_metadata.tsv")
            def arborator_2505SAL_01_outliers = path("$launchDir/results/arborator/2505SAL-01_outliers.tsv")
            def arborator_2505SAL_01_profile = path("$launchDir/results/arborator/2505SAL-01_profile.tsv")
            def arborator_2505SAL_01_tree = path("$launchDir/results/arborator/2505SAL-01_tree.nwk")

            assert arborator_2505SAL_01_clusters.exists()
            assert arborator_2505SAL_01_loci.exists()
            assert arborator_2505SAL_01_matrix.exists()
            assert arborator_2505SAL_01_metadata.exists()
            assert arborator_2505SAL_01_outliers.exists()
            assert arborator_2505SAL_01_profile.exists()
            assert arborator_2505SAL_01_tree.exists()

            def arborator_2506SAL_01_clusters = path("$launchDir/results/arborator/2506SAL-01_clusters.tsv")
            def arborator_2506SAL_01_loci = path("$launchDir/results/arborator/2506SAL-01_loci.summary.tsv")
            def arborator_2506SAL_01_matrix = path("$launchDir/results/arborator/2506SAL-01_matrix.tsv")
            def arborator_2506SAL_01_metadata = path("$launchDir/results/arborator/2506SAL-01_metadata.tsv")
            def arborator_2506SAL_01_outliers = path("$launchDir/results/arborator/2506SAL-01_outliers.tsv")
            def arborator_2506SAL_01_profile = path("$launchDir/results/arborator/2506SAL-01_profile.tsv")
            def arborator_2506SAL_01_tree = path("$launchDir/results/arborator/2506SAL-01_tree.nwk")

            assert arborator_2506SAL_01_clusters.exists()
            assert arborator_2506SAL_01_loci.exists()
            assert arborator_2506SAL_01_matrix.exists()
            assert arborator_2506SAL_01_metadata.exists()
            assert arborator_2506SAL_01_outliers.exists()
            assert arborator_2506SAL_01_profile.exists()
            assert arborator_2506SAL_01_tree.exists()

            def arborator_2507monoSTWGS_01_clusters = path("$launchDir/results/arborator/2507monoSTWGS-01_clusters.tsv")
            def arborator_2507monoSTWGS_01_loci = path("$launchDir/results/arborator/2507monoSTWGS-01_loci.summary.tsv")
            def arborator_2507monoSTWGS_01_matrix = path("$launchDir/results/arborator/2507monoSTWGS-01_matrix.tsv")
            def arborator_2507monoSTWGS_01_metadata = path("$launchDir/results/arborator/2507monoSTWGS-01_metadata.tsv")
            def arborator_2507monoSTWGS_01_outliers = path("$launchDir/results/arborator/2507monoSTWGS-01_outliers.tsv")
            def arborator_2507monoSTWGS_01_profile = path("$launchDir/results/arborator/2507monoSTWGS-01_profile.tsv")
            def arborator_2507monoSTWGS_01_tree = path("$launchDir/results/arborator/2507monoSTWGS-01_tree.nwk")

            assert arborator_2507monoSTWGS_01_clusters.exists()
            assert arborator_2507monoSTWGS_01_loci.exists()
            assert arborator_2507monoSTWGS_01_matrix.exists()
            assert arborator_2507monoSTWGS_01_metadata.exists()
            assert arborator_2507monoSTWGS_01_outliers.exists()
            assert arborator_2507monoSTWGS_01_profile.exists()
            assert arborator_2507monoSTWGS_01_tree.exists()

            def arborator_2509SAL_01_clusters = path("$launchDir/results/arborator/2509SAL-01_clusters.tsv")
            def arborator_2509SAL_01_loci = path("$launchDir/results/arborator/2509SAL-01_loci.summary.tsv")
            def arborator_2509SAL_01_matrix = path("$launchDir/results/arborator/2509SAL-01_matrix.tsv")
            def arborator_2509SAL_01_metadata = path("$launchDir/results/arborator/2509SAL-01_metadata.tsv")
            def arborator_2509SAL_01_outliers = path("$launchDir/results/arborator/2509SAL-01_outliers.tsv")
            def arborator_2509SAL_01_profile = path("$launchDir/results/arborator/2509SAL-01_profile.tsv")
            def arborator_2509SAL_01_tree = path("$launchDir/results/arborator/2509SAL-01_tree.nwk")

            assert arborator_2509SAL_01_clusters.exists()
            assert arborator_2509SAL_01_loci.exists()
            assert arborator_2509SAL_01_matrix.exists()
            assert arborator_2509SAL_01_metadata.exists()
            assert arborator_2509SAL_01_outliers.exists()
            assert arborator_2509SAL_01_profile.exists()
            assert arborator_2509SAL_01_tree.exists()

            def arborator_2509SAL_02_clusters = path("$launchDir/results/arborator/2509SAL-02_clusters.tsv")
            def arborator_2509SAL_02_loci = path("$launchDir/results/arborator/2509SAL-02_loci.summary.tsv")
            def arborator_2509SAL_02_matrix = path("$launchDir/results/arborator/2509SAL-02_matrix.tsv")
            def arborator_2509SAL_02_metadata = path("$launchDir/results/arborator/2509SAL-02_metadata.tsv")
            def arborator_2509SAL_02_outliers = path("$launchDir/results/arborator/2509SAL-02_outliers.tsv")
            def arborator_2509SAL_02_profile = path("$launchDir/results/arborator/2509SAL-02_profile.tsv")
            def arborator_2509SAL_02_tree = path("$launchDir/results/arborator/2509SAL-02_tree.nwk")

            assert arborator_2509SAL_02_clusters.exists()
            assert arborator_2509SAL_02_loci.exists()
            assert arborator_2509SAL_02_matrix.exists()
            assert arborator_2509SAL_02_metadata.exists()
            assert arborator_2509SAL_02_outliers.exists()
            assert arborator_2509SAL_02_profile.exists()
            assert arborator_2509SAL_02_tree.exists()

            def arborator_2511InfantisWGS_01_clusters = path("$launchDir/results/arborator/2511InfantisWGS-01_clusters.tsv")
            def arborator_2511InfantisWGS_01_loci = path("$launchDir/results/arborator/2511InfantisWGS-01_loci.summary.tsv")
            def arborator_2511InfantisWGS_01_matrix = path("$launchDir/results/arborator/2511InfantisWGS-01_matrix.tsv")
            def arborator_2511InfantisWGS_01_metadata = path("$launchDir/results/arborator/2511InfantisWGS-01_metadata.tsv")
            def arborator_2511InfantisWGS_01_outliers = path("$launchDir/results/arborator/2511InfantisWGS-01_outliers.tsv")
            def arborator_2511InfantisWGS_01_profile = path("$launchDir/results/arborator/2511InfantisWGS-01_profile.tsv")
            def arborator_2511InfantisWGS_01_tree = path("$launchDir/results/arborator/2511InfantisWGS-01_tree.nwk")

            assert arborator_2511InfantisWGS_01_clusters.exists()
            assert arborator_2511InfantisWGS_01_loci.exists()
            assert arborator_2511InfantisWGS_01_matrix.exists()
            assert arborator_2511InfantisWGS_01_metadata.exists()
            assert arborator_2511InfantisWGS_01_outliers.exists()
            assert arborator_2511InfantisWGS_01_profile.exists()
            assert arborator_2511InfantisWGS_01_tree.exists()

            def cluster_summary = path("$launchDir/results/arborator/cluster_summary.tsv")
            def cluster_summary_xlsx = path("$launchDir/results/arborator/cluster_summary.xlsx")
            def metadata_excluded = path("$launchDir/results/arborator/metadata.excluded.tsv")
            def metadata_included = path("$launchDir/results/arborator/metadata.included.tsv")
            def metadata_linelist = path("$launchDir/results/arborator/metadata.linelist.xlsx")
            def run_json = path("$launchDir/results/arborator/run.json")
            def threshold_map = path("$launchDir/results/arborator/threshold_map.json")

            assert cluster_summary.exists()
            assert cluster_summary_xlsx.exists()
            assert metadata_excluded.exists()
            assert metadata_included.exists()
            assert metadata_linelist.exists()
            assert run_json.exists()
            assert threshold_map.exists()

            def arborview_2501STWGS_01 = path("$launchDir/results/arborview/2501STWGS-01_arborview.html")
            def arborview_2502SEWGS_01 = path("$launchDir/results/arborview/2502SEWGS-01_arborview.html")
            def arborview_2503SHWGS_01 = path("$launchDir/results/arborview/2503SHWGS-01_arborview.html")
            def arborview_2504SAL_01 = path("$launchDir/results/arborview/2504SAL-01_arborview.html")
            def arborview_2505SAL_01 = path("$launchDir/results/arborview/2505SAL-01_arborview.html")
            def arborview_2506SAL_01 = path("$launchDir/results/arborview/2506SAL-01_arborview.html")
            def arborview_2507monoSTWGS_01 = path("$launchDir/results/arborview/2507monoSTWGS-01_arborview.html")
            def arborview_2509SAL_01 = path("$launchDir/results/arborview/2509SAL-01_arborview.html")
            def arborview_2509SAL_02 = path("$launchDir/results/arborview/2509SAL-02_arborview.html")
            def arborview_2511InfantisWGS_01 = path("$launchDir/results/arborview/2511InfantisWGS-01_arborview.html")

            assert arborview_2501STWGS_01.exists()
            assert arborview_2502SEWGS_01.exists()
            assert arborview_2503SHWGS_01.exists()
            assert arborview_2504SAL_01.exists()
            assert arborview_2505SAL_01.exists()
            assert arborview_2506SAL_01.exists()
            assert arborview_2507monoSTWGS_01.exists()
            assert arborview_2509SAL_01.exists()
            assert arborview_2509SAL_02.exists()
            assert arborview_2511InfantisWGS_01.exists()

            def iridanext_output = path("$launchDir/results/iridanext.output.json")

            assert iridanext_output.exists()

            // Irida Next Output:
            def iridanext_json = iridanext_output.json
            def iridanext_global = iridanext_json.files.global
            def iridanext_samples = iridanext_json.files.samples
            def iridanext_metadata = iridanext_json.metadata.samples

            assert iridanext_global.findAll { it.path == "arborator/2501STWGS-01_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2501STWGS-01_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2501STWGS-01_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2501STWGS-01_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2501STWGS-01_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2501STWGS-01_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2501STWGS-01_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2502SEWGS-01_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2502SEWGS-01_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2502SEWGS-01_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2502SEWGS-01_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2502SEWGS-01_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2502SEWGS-01_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2502SEWGS-01_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2503SHWGS-01_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2503SHWGS-01_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2503SHWGS-01_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2503SHWGS-01_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2503SHWGS-01_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2503SHWGS-01_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2503SHWGS-01_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2504SAL-01_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2504SAL-01_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2504SAL-01_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2504SAL-01_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2504SAL-01_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2504SAL-01_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2504SAL-01_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2505SAL-01_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2505SAL-01_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2505SAL-01_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2505SAL-01_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2505SAL-01_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2505SAL-01_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2505SAL-01_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2506SAL-01_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2506SAL-01_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2506SAL-01_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2506SAL-01_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2506SAL-01_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2506SAL-01_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2506SAL-01_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2507monoSTWGS-01_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2507monoSTWGS-01_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2507monoSTWGS-01_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2507monoSTWGS-01_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2507monoSTWGS-01_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2507monoSTWGS-01_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2507monoSTWGS-01_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2509SAL-01_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-01_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-01_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-01_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-01_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-01_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-01_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2509SAL-02_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-02_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-02_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-02_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-02_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-02_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2509SAL-02_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/2511InfantisWGS-01_clusters.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2511InfantisWGS-01_loci.summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2511InfantisWGS-01_matrix.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2511InfantisWGS-01_metadata.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2511InfantisWGS-01_outliers.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2511InfantisWGS-01_profile.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/2511InfantisWGS-01_tree.nwk" }.size() == 1

            assert iridanext_global.findAll { it.path == "arborator/cluster_summary.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/metadata.excluded.tsv" }.size() == 1
            assert iridanext_global.findAll { it.path == "arborator/metadata.included.tsv" }.size() == 1
        }
    }
}
