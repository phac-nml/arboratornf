# phac-nml/arboratornf: Output

## Introduction

This document describes the output produced by the pipeline.

The directories listed below will be created in the results directory after the pipeline has finished. All paths are relative to the top-level results directory.

- arborator: Output from Arborator containing the cluster summary file and results for each individual cluster.
- arborview: The ArborView visualization of a dendrogram alongside metadata.
- build: Contains the automatically generated JSON-formatted config file for formatting the clustering information shown to the user by Arborator.
- merged: Contains a file with all genomic profiles provided in the input sample sheet merged into one TSV-formatted file.
- metadata: Contains a file with all metadata assocated with each genomic profile provided in the input sample sheet merged into one TSV-formatted file.
- pipeline_info: Information about the pipeline's execution.

The IRIDA Next-compliant JSON output file will be named `iridanext.output.json.gz` and will be written to the top-level of the results directory. This file is compressed using GZIP and conforms to the [IRIDA Next JSON output specifications](https://github.com/phac-nml/pipeline-standards#42-irida-next-json).

## Pipeline overview

The pipeline is built using [Nextflow](https://www.nextflow.io/) and processes data using the following steps:

- [Locidex Merge](#locidex-merge) - Merges multiple genomic profiles provided in the sample sheet into one TSV-formatted file.
- [Map to TSV](#map-to-tsv) - Generates a TSV-formatted file containing all metadata in an Arborator-compliant format.
- [Build Config](#build-config) - Builds an Aborator-compliant config file to facilitate improved readability of Arborator outputs.
- [Arborator](#arborator) - Runs Arborator to generate cluster and metadata summaries.
- [ArborView](#arborview) - Generates a visualization of a dendogram alongside metadata.
- [Pipeline Information](#pipeline-information) - Report metrics generated during the workflow execution.

### Locidex Merge

<details markdown="1">
<summary>Output files</summary>

- `merged/`
  - Merged profiles: `profile.tsv`

</details>

### Map to TSV

<details markdown="1">
<summary>Output files</summary>

- `metadata/`
  - Merged metadata: `aggregated_data.tsv`

</details>

### Build Config

<details markdown="1">
<summary>Output files</summary>

- `build/`
  - Generated Arborview config file: `config.json`

</details>

### Arborator

<details markdown="1">
<summary>Output files</summary>

- `arborator/`
  - Numbered directories containing information about each cluster: `[N/]`
  - Cluster summary: `cluster_summary.tsv`
  - Line list summarizes metadata of excluded profiles: `metadata.excluded.tsv`
  - Line list summarizes metadata of included profiles: `metadata.included.tsv`
  - Summary of clustering thresholds used: `threshold_map.json`
  - Directory containing information about unassociated clusters: `unassociated`

</details>

### ArborView

<details markdown="1">
<summary>Output files</summary>

- `arborview/`
  - Viewable HTML-formatted dendogram for each cluster: `[N]_arborview.html`

</details>

### Pipeline information

<details markdown="1">
<summary>Output files</summary>

- `pipeline_info/`
  - Reports generated by Nextflow: `execution_report.html`, `execution_timeline.html`, `execution_trace.txt` and `pipeline_dag.dot`/`pipeline_dag.svg`.
  - Reports generated by the pipeline: `pipeline_report.html`, `pipeline_report.txt` and `software_versions.yml`. The `pipeline_report*` files will only be present if the `--email` / `--email_on_fail` parameter's are used when running the pipeline.
  - Reformatted samplesheet files used as input to the pipeline: `samplesheet.valid.csv`.
  - Parameters used by the pipeline run: `params.json`.

</details>

[Nextflow](https://www.nextflow.io/docs/latest/tracing.html) provides excellent functionality for generating various reports relevant to the running and execution of the pipeline. This will allow you to troubleshoot errors with the running of the pipeline, and also provide you with other information such as launch commands, run times and resource usage.
